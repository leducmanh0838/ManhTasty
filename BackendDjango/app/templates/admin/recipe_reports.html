{% extends "admin/base_site.html" %}
{% load static %}

{% block extrastyle %}
    {{ block.super }}
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker.min.css" rel="stylesheet">
{% endblock %}

{% block content %}

<form method="get" class="mb-3 d-flex align-items-center gap-3 flex-wrap">
    <div>
        <label for="by">Thống kê theo:</label>
        <select name="by" id="by" class="form-select d-inline-block w-auto h-auto">
            <option value="day" {% if request.GET.by == "day" %}selected{% endif %}>Ngày</option>
            <option value="month" {% if request.GET.by == "month" or not request.GET.by %}selected{% endif %}>Tháng</option>
            <option value="quarter" {% if request.GET.by == "quarter" %}selected{% endif %}>Quý</option>
            <option value="year" {% if request.GET.by == "year" %}selected{% endif %}>Năm</option>
        </select>
    </div>

    <div>
        <label for="start">Từ ngày:</label>
        <input type="date" name="start" id="start" value="{{ start_date|date:'Y-m-d' }}"
               class="form-control d-inline-block w-auto">
    </div>

    <div>
        <label for="end">Đến ngày:</label>
        <input type="date" name="end" id="end" value="{{ end_date|date:'Y-m-d' }}"
               class="form-control d-inline-block w-auto">
    </div>

    <div>
        <button type="submit" class="btn btn-primary">Xem</button>
    </div>
</form>

<canvas id="recipeChart" width="800" height="400"></canvas>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    const ctx = document.getElementById('recipeChart').getContext('2d');
    const chart = new Chart(ctx, {
        type: "{{ chart_type }}",
        data: {
            labels: {{ labels|safe }},
            datasets: [{
                label: 'Số công thức theo {{ by }}',
                data: {{ values|safe }},
                backgroundColor: 'rgba(75, 192, 192, 0.6)',
                borderColor: 'rgba(75, 192, 192, 1)',
                borderWidth: 1,
                fill: true,
                tension: 0.3
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: { display: false }
            },
            scales: {
                y: { beginAtZero: true }
            }
        }
    });
</script>
{% endblock %}
